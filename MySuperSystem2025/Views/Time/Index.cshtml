@model MySuperSystem2025.Models.ViewModels.Time.TimeDashboardViewModel
@{
    ViewData["Title"] = "Time Tracker";
}

<style>
    .time-dashboard {
        max-width: 1400px;
        margin: 0 auto;
    }
    
    .page-header {
        margin-bottom: 2rem;
    }
    
    .page-header h1 {
        font-size: 1.75rem;
        font-weight: 600;
        color: #1a1a1a;
        margin-bottom: 0.5rem;
    }
    
    .summary-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.25rem;
        margin-bottom: 2rem;
    }
    
    .summary-card {
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 1.5rem;
    }
    
    .summary-label {
        font-size: 0.875rem;
        color: #6c757d;
        margin-bottom: 0.5rem;
    }
    
    .summary-value {
        font-size: 1.75rem;
        font-weight: 600;
        color: #1a1a1a;
        margin-bottom: 0.25rem;
    }
    
    .summary-count {
        font-size: 0.875rem;
        color: #6c757d;
    }
    
    .content-grid {
        display: grid;
        grid-template-columns: 1fr 400px;
        gap: 1.5rem;
        margin-bottom: 2rem;
    }
    
    @@media (max-width: 1024px) {
        .content-grid {
            grid-template-columns: 1fr;
        }
    }
    
    .main-card {
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 1.75rem;
    }
    
    .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
    }
    
    .card-title {
        font-size: 1rem;
        font-weight: 600;
        color: #1a1a1a;
    }
    
    .filter-dropdown {
        position: relative;
    }
    
    .category-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .category-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem;
        border-bottom: 1px solid #f3f4f6;
    }
    
    .category-item:last-child {
        border-bottom: none;
    }
    
    .category-info {
        flex: 1;
    }
    
    .category-name {
        font-weight: 500;
        color: #1a1a1a;
        margin-bottom: 0.25rem;
    }
    
    .category-count {
        font-size: 0.875rem;
        color: #6c757d;
    }
    
    .category-duration {
        font-size: 1.125rem;
        font-weight: 600;
        color: #1a1a1a;
        text-align: right;
    }
    
    .category-percentage {
        font-size: 0.875rem;
        color: #6c757d;
        text-align: right;
    }
    
    .recent-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .recent-item {
        padding: 1rem;
        border-bottom: 1px solid #f3f4f6;
    }
    
    .recent-item:last-child {
        border-bottom: none;
    }
    
    .recent-header {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: 0.5rem;
    }
    
    .recent-category {
        font-weight: 500;
        color: #1a1a1a;
    }
    
    .recent-duration {
        font-weight: 600;
        color: #d97706;
    }
    
    .recent-time {
        font-size: 0.875rem;
        color: #6c757d;
        margin-bottom: 0.25rem;
    }
    
    .recent-notes {
        font-size: 0.875rem;
        color: #6c757d;
        font-style: italic;
    }
    
    .empty-state {
        text-align: center;
        padding: 3rem 1rem;
        color: #6c757d;
    }
    
    .empty-state i {
        font-size: 3rem;
        margin-bottom: 1rem;
        opacity: 0.3;
    }
    
    .action-buttons {
        display: flex;
        gap: 0.75rem;
        flex-wrap: wrap;
    }
    
    .btn-primary {
        background: #2563eb;
        border-color: #2563eb;
        padding: 0.625rem 1.25rem;
        font-size: 0.875rem;
        font-weight: 500;
    }
    
    .btn-primary:hover {
        background: #1d4ed8;
        border-color: #1d4ed8;
    }
    
    .btn-outline-secondary {
        padding: 0.625rem 1.25rem;
        font-size: 0.875rem;
        font-weight: 500;
    }
</style>

<div class="time-dashboard">
    <div class="page-header">
        <div class="d-flex justify-content-between align-items-start">
            <div>
                <h1><i class="bi bi-clock-history me-2"></i>Time Tracker</h1>
                <p class="text-muted mb-0">Track and analyze time spent on activities</p>
            </div>
            <div class="action-buttons">
                <a asp-action="Create" class="btn btn-primary">
                    <i class="bi bi-plus-circle me-1"></i>Add Time Entry
                </a>
                <a asp-action="Categories" class="btn btn-outline-secondary">
                    <i class="bi bi-tags me-1"></i>Categories
                </a>
                <a asp-action="List" class="btn btn-outline-secondary">
                    <i class="bi bi-list-ul me-1"></i>All Entries
                </a>
            </div>
        </div>
    </div>

    <!-- Summary Cards -->
    <div class="summary-grid">
        <div class="summary-card">
            <div class="summary-label">Today</div>
            <div class="summary-value">@Model.FormattedTodayDuration</div>
            <div class="summary-count">@Model.TodayCount @(Model.TodayCount == 1 ? "entry" : "entries")</div>
        </div>
        <div class="summary-card">
            <div class="summary-label">This Week</div>
            <div class="summary-value">@Model.FormattedWeeklyDuration</div>
            <div class="summary-count">@Model.WeeklyCount @(Model.WeeklyCount == 1 ? "entry" : "entries")</div>
        </div>
        <div class="summary-card">
            <div class="summary-label">This Month</div>
            <div class="summary-value">@Model.FormattedMonthlyDuration</div>
            <div class="summary-count">@Model.MonthlyCount @(Model.MonthlyCount == 1 ? "entry" : "entries")</div>
        </div>
    </div>

    <!-- Content Grid -->
    <div class="content-grid">
        <!-- Category Breakdown -->
        <div class="main-card">
            <div class="card-header">
                <h5 class="card-title">Time by Category - @Model.BreakdownPeriodName</h5>
                <div class="dropdown">
                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="filterDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-funnel me-1"></i>Filter
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="filterDropdown">
                        <li><a class="dropdown-item @(Model.BreakdownPeriod == "daily" ? "active" : "")" asp-action="Index" asp-route-period="daily">Today</a></li>
                        <li><a class="dropdown-item @(Model.BreakdownPeriod == "weekly" ? "active" : "")" asp-action="Index" asp-route-period="weekly">This Week</a></li>
                        <li><a class="dropdown-item @(Model.BreakdownPeriod == "monthly" ? "active" : "")" asp-action="Index" asp-route-period="monthly">This Month</a></li>
                    </ul>
                </div>
            </div>

            @if (Model.CategoryBreakdown.Any())
            {
                <ul class="category-list">
                    @foreach (var category in Model.CategoryBreakdown)
                    {
                        <li class="category-item">
                            <div class="category-info">
                                <div class="category-name">@category.CategoryName</div>
                                <div class="category-count">@category.Count @(category.Count == 1 ? "entry" : "entries")</div>
                            </div>
                            <div>
                                <div class="category-duration">@category.FormattedDuration</div>
                                <div class="category-percentage">@category.Percentage%</div>
                            </div>
                        </li>
                    }
                </ul>
            }
            else
            {
                <div class="empty-state">
                    <i class="bi bi-pie-chart"></i>
                    <p>No time entries for this period</p>
                </div>
            }
        </div>

        <!-- Recent Entries -->
        <div class="main-card">
            <div class="card-header">
                <h5 class="card-title">Recent Entries</h5>
            </div>

            @if (Model.RecentEntries.Any())
            {
                <ul class="recent-list">
                    @foreach (var entry in Model.RecentEntries)
                    {
                        <li class="recent-item">
                            <div class="recent-header">
                                <span class="recent-category">@entry.CategoryName</span>
                                <span class="recent-duration">@entry.FormattedDuration</span>
                            </div>
                            <div class="recent-time">
                                @entry.StartTime.ToString("MMM dd, yyyy HH:mm") - @entry.EndTime.ToString("HH:mm")
                            </div>
                            @if (!string.IsNullOrEmpty(entry.Notes))
                            {
                                <div class="recent-notes">@entry.Notes</div>
                            }
                        </li>
                    }
                </ul>
            }
            else
            {
                <div class="empty-state">
                    <i class="bi bi-clock"></i>
                    <p>No time entries yet</p>
                </div>
            }
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Manually initialize Bootstrap dropdown
        document.addEventListener('DOMContentLoaded', function() {
            var dropdownButton = document.getElementById('filterDropdown');
            
            if (dropdownButton && typeof bootstrap !== 'undefined') {
                var dropdown = new bootstrap.Dropdown(dropdownButton, {
                    autoClose: true
                });
                
                console.log('Time Tracker filter dropdown initialized');
                
                // Add click event as fallback
                dropdownButton.addEventListener('click', function(e) {
                    e.preventDefault();
                    dropdown.toggle();
                });
            } else {
                console.error('Bootstrap not loaded or dropdown element not found');
            }
        });
    </script>
}
